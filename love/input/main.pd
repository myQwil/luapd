#N canvas 150 400 450 300 14;
#N canvas 600 400 450 300 echo 0;
#X obj 70 120 adc~;
#X obj 40 20 inlet;
#X obj 40 50 switch~;
#X obj 300 20 r \$0opt1;
#X obj 160 230 delwrite~ \$0-echoR 500;
#X obj 160 260 delwrite~ \$0-echoL 500;
#X obj 160 120 delread4~ \$0-echoL;
#X obj 160 150 delread4~ \$0-echoR;
#X obj 120 20 r \$0opt2;
#X obj 70 190 *~;
#X obj 130 190 *~;
#X obj 120 80 zp~ 25 0.5;
#X obj 300 80 zp~ 25 150;
#X obj 120 50 sly log 0.001 0.97 1;
#X obj 300 50 sly 50 500 1;
#X obj 70 260 add~;
#X connect 0 0 9 0;
#X connect 0 1 10 0;
#X connect 1 0 2 0;
#X connect 3 0 14 0;
#X connect 6 0 9 0;
#X connect 7 0 10 0;
#X connect 8 0 13 0;
#X connect 9 0 5 0;
#X connect 9 0 15 0;
#X connect 10 0 4 0;
#X connect 10 0 15 1;
#X connect 11 0 9 1;
#X connect 11 0 10 1;
#X connect 12 0 7 0;
#X connect 12 0 6 0;
#X connect 13 0 11 0;
#X connect 14 0 12 0;
#X restore 50 170 pd echo;
#X obj 50 140 == 0;
#N canvas 600 400 450 300 cos 0;
#X obj 170 100 adc~;
#X obj 40 40 inlet;
#X obj 40 70 switch~;
#X obj 170 140 cos~;
#X obj 220 140 cos~;
#X obj 170 180 add~;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 2 0;
#X connect 3 0 5 0;
#X connect 4 0 5 1;
#X restore 130 170 pd cos;
#X obj 130 140 == 1;
#N canvas 600 400 450 300 8ve 0;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#X obj 120 120 adc~;
#X obj 120 200 add~;
#N canvas 730 350 450 450 8ve 0;
#X obj 60 110 moses 1;
#X obj 80 140 mtof;
#X obj 190 200 samplerate~;
#X obj 80 200 t f b;
#X obj 80 370 +~;
#X obj 80 230 +;
#X obj 80 170 expr 500/$f1;
#X obj 80 290 line~;
#X obj 80 260 pack 0 20;
#X text 130 140 fundamental frequency;
#X text 200 170 1/2 period \, in msec;
#X text 200 250 estimate fiddle~ delay;
#X obj 190 230 expr 2048000/$f1;
#X text 200 270 as one window (in msec);
#X obj 60 80 sigmund~ -npts 2048;
#X obj 60 20 inlet~;
#X obj 80 400 outlet~;
#X obj 70 50 delwrite~ G06-L 100;
#X obj 80 320 vd~ G06-L;
#X obj 190 320 delread~ G06-L;
#X connect 0 1 1 0;
#X connect 1 0 6 0;
#X connect 2 0 12 0;
#X connect 3 0 5 0;
#X connect 3 1 2 0;
#X connect 4 0 16 0;
#X connect 5 0 8 0;
#X connect 6 0 3 0;
#X connect 7 0 18 0;
#X connect 8 0 7 0;
#X connect 12 0 5 1;
#X connect 12 0 19 0;
#X connect 14 0 0 0;
#X connect 15 0 14 0;
#X connect 15 0 17 0;
#X connect 18 0 4 0;
#X connect 19 0 4 1;
#X restore 120 160 pd 8ve;
#N canvas 1180 350 450 450 8ve 0;
#X obj 60 110 moses 1;
#X obj 80 140 mtof;
#X obj 190 200 samplerate~;
#X obj 80 200 t f b;
#X obj 80 370 +~;
#X obj 80 230 +;
#X obj 80 170 expr 500/$f1;
#X obj 80 290 line~;
#X obj 80 260 pack 0 20;
#X text 130 140 fundamental frequency;
#X text 200 170 1/2 period \, in msec;
#X text 200 250 estimate fiddle~ delay;
#X obj 190 230 expr 2048000/$f1;
#X text 200 270 as one window (in msec);
#X obj 60 80 sigmund~ -npts 2048;
#X obj 60 20 inlet~;
#X obj 80 400 outlet~;
#X obj 70 50 delwrite~ G06-R 100;
#X obj 80 320 vd~ G06-R;
#X obj 190 320 delread~ G06-R;
#X connect 0 1 1 0;
#X connect 1 0 6 0;
#X connect 2 0 12 0;
#X connect 3 0 5 0;
#X connect 3 1 2 0;
#X connect 4 0 16 0;
#X connect 5 0 8 0;
#X connect 6 0 3 0;
#X connect 7 0 18 0;
#X connect 8 0 7 0;
#X connect 12 0 5 1;
#X connect 12 0 19 0;
#X connect 14 0 0 0;
#X connect 15 0 14 0;
#X connect 15 0 17 0;
#X connect 18 0 4 0;
#X connect 19 0 4 1;
#X restore 180 160 pd 8ve;
#X connect 0 0 1 0;
#X connect 2 0 4 0;
#X connect 2 1 5 0;
#X connect 4 0 3 0;
#X connect 5 0 3 1;
#X restore 210 170 pd 8ve;
#X obj 210 140 == 2;
#X obj 180 30 hradio 22 1 0 5 empty empty empty 0 -11 0 14 #7c7c7c #fcfcfc #fcfcfc 0;
#N canvas 600 400 450 300 stamp 0;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#N canvas 350 20 620 600 fft-analysis 0;
#X obj 90 450 *~;
#X obj 50 450 *~;
#X obj 300 250 *~;
#X obj 260 250 *~;
#X obj 260 280 +~;
#X obj 50 190 *~;
#X obj 50 160 inlet~;
#X obj 50 220 rfft~;
#X obj 50 510 *~;
#X obj 260 220 rfft~;
#X obj 50 480 rifft~;
#X obj 50 540 outlet~;
#X text 420 280 modulus;
#X obj 180 350 *~;
#X obj 390 440 block~ 1024 4;
#X obj 90 190 tabreceive~ \$0-hann;
#X obj 390 470 loadbang;
#X obj 180 390 *~ 0.00065;
#X obj 170 510 tabreceive~ \$0-hann;
#X obj 260 190 *~;
#X obj 260 160 inlet~;
#X obj 380 190 tabreceive~ \$0-hann;
#X obj 260 310 sqrt~;
#X text 420 300 of control;
#X text 420 320 amplitude;
#X text 110 160 filter input;
#X text 410 160 control source;
#X text 410 220 Fourier transform;
#X text 40 10 Internal workings of the timbre stamping algorithm. First the "filter input" is treated as in the compressor patch \, multiplying each channel amplitude by one over its modulus (but limited by the "squelch" parameter.) It is then multiplied by the modulus of the channel amplitude for the control source (which is Fourier analyzed in parallel with the filter input.);
#X text 380 360 multiply the two amplitude;
#X text 380 380 factors (for compression;
#X text 380 400 and to apply new timbre);
#X msg 390 500 \; window-size 1024 \; squelch 500;
#X obj 170 450 *~;
#X obj 130 450 *~;
#X obj 380 250 *~;
#X obj 340 250 *~;
#X obj 340 280 +~;
#X obj 130 510 *~;
#X obj 340 220 rfft~;
#X obj 130 480 rifft~;
#X obj 130 540 outlet~;
#X obj 280 350 *~;
#X obj 280 390 *~ 0.00065;
#X obj 340 190 *~;
#X obj 340 160 inlet~;
#X obj 340 310 sqrt~;
#N canvas 730 350 450 330 recip 0;
#X obj 110 70 *~;
#X obj 70 70 *~;
#X obj 70 100 +~;
#X obj 70 250 clip~;
#X obj 90 190 r squelch;
#X obj 90 220 expr 0.01*$f1*$f1;
#X obj 70 130 +~ 1e-20;
#X obj 70 160 rsqrt~;
#X text 140 80 reciprocal;
#X text 140 100 modulus of;
#X text 140 120 filter input;
#X text 140 140 amplitude;
#X obj 70 30 inlet~;
#X obj 130 30 inlet~;
#X obj 70 280 outlet~;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 3 0 14 0;
#X connect 4 0 5 0;
#X connect 5 0 3 2;
#X connect 6 0 7 0;
#X connect 7 0 3 0;
#X connect 12 0 1 0;
#X connect 12 0 1 1;
#X connect 13 0 0 0;
#X connect 13 0 0 1;
#X restore 180 310 pd recip;
#X connect 0 0 10 1;
#X connect 1 0 10 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 22 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 1 0;
#X connect 7 0 34 0;
#X connect 7 0 47 0;
#X connect 7 1 0 0;
#X connect 7 1 33 0;
#X connect 7 1 47 1;
#X connect 8 0 11 0;
#X connect 9 0 3 0;
#X connect 9 0 3 1;
#X connect 9 1 2 0;
#X connect 9 1 2 1;
#X connect 10 0 8 0;
#X connect 13 0 17 0;
#X connect 15 0 5 1;
#X connect 16 0 32 0;
#X connect 17 0 0 1;
#X connect 17 0 1 1;
#X connect 18 0 8 1;
#X connect 18 0 38 1;
#X connect 19 0 9 0;
#X connect 20 0 19 0;
#X connect 21 0 19 1;
#X connect 21 0 44 1;
#X connect 22 0 13 1;
#X connect 33 0 40 1;
#X connect 34 0 40 0;
#X connect 35 0 37 1;
#X connect 36 0 37 0;
#X connect 37 0 46 0;
#X connect 38 0 41 0;
#X connect 39 0 36 0;
#X connect 39 0 36 1;
#X connect 39 1 35 0;
#X connect 39 1 35 1;
#X connect 40 0 38 0;
#X connect 42 0 43 0;
#X connect 43 0 33 1;
#X connect 43 0 34 1;
#X connect 44 0 39 0;
#X connect 45 0 44 0;
#X connect 46 0 42 1;
#X connect 47 0 13 0;
#X connect 47 0 42 0;
#X restore 230 150 pd fft-analysis;
#N canvas 950 160 560 520 hann-window 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-hann 1024 float 0;
#X coords 0 1 1023 0 300 100 1;
#X restore 120 390 graph;
#X obj 360 210 osc~;
#X obj 360 240 *~ -0.5;
#X obj 360 270 +~ 0.5;
#X obj 340 330 tabwrite~ \$0-hann;
#X obj 60 110 r window-size;
#X obj 170 240 /;
#X obj 190 200 samplerate~;
#X obj 170 330 s window-sec;
#X obj 60 330 s window-hz;
#X obj 180 270 * 1000;
#X obj 180 300 s window-msec;
#X obj 60 140 t f b f;
#X msg 190 140 resize \$1;
#X obj 190 170 s \$0-hann;
#X obj 310 140 r window-hz;
#X msg 390 170 0;
#X obj 310 170 t f b;
#X text 50 20 calculate Hann window table (variable window size) and constants window-hz (fundamental frequency of analysis) \, window-sec and window-msec (analysis window size in seconds and msec)., f 56;
#X obj 60 240 @/;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 12 0;
#X connect 6 0 8 0;
#X connect 6 0 10 0;
#X connect 7 0 6 1;
#X connect 7 0 19 1;
#X connect 10 0 11 0;
#X connect 12 0 6 0;
#X connect 12 0 19 0;
#X connect 12 1 7 0;
#X connect 12 2 13 0;
#X connect 13 0 14 0;
#X connect 15 0 17 0;
#X connect 16 0 1 1;
#X connect 17 0 1 0;
#X connect 17 1 4 0;
#X connect 17 1 16 0;
#X connect 19 0 9 0;
#X restore 230 90 pd hann-window;
#N canvas 380 50 450 300 signals 0;
#X obj 90 230 outlet~;
#X obj 270 230 outlet~;
#X obj 270 190 adc~;
#X obj 180 110 tgl 19 0 empty empty empty 0 -10 0 12 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 210 110 loadbang;
#X obj 90 50 r \$0opt1;
#X obj 90 140 zp~ 25 25;
#X obj 90 80 sly log 12.5 500 1;
#X obj 340 230 outlet~;
#X obj 90 190 fm2op~ 25 0 1 4;
#N canvas 260 200 450 300 rand 0;
#X obj 240 100 metro 10000;
#X obj 240 130 rind 2 8;
#X obj 240 160 zp~ 10000 4;
#X obj 100 190 outlet~;
#X obj 240 190 outlet~;
#X obj 240 60 inlet;
#X obj 100 130 rind 1 2.5;
#X floatatom 190 100 0 0 0 0 - - - 0;
#X obj 100 100 metro 600;
#X floatatom 190 130 0 0 0 0 - - - 0;
#X obj 100 160 zp~ 600 1;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 4 0;
#X connect 5 0 0 0;
#X connect 6 0 10 0;
#X connect 7 0 6 2;
#X connect 8 0 6 0;
#X connect 9 0 8 1;
#X connect 9 0 10 1;
#X connect 10 0 3 0;
#X restore 180 140 pd rand;
#X connect 2 0 1 0;
#X connect 2 1 8 0;
#X connect 3 0 10 0;
#X connect 4 0 10 0;
#X connect 5 0 7 0;
#X connect 6 0 9 0;
#X connect 7 0 6 0;
#X connect 9 0 0 0;
#X connect 10 0 9 2;
#X connect 10 1 9 3;
#X restore 230 120 pd signals;
#X obj 60 190 s squelch;
#X obj 60 120 r \$0opt2;
#X obj 60 150 sly 0 2000 1;
#X obj 230 190 add~;
#X connect 0 0 1 0;
#X connect 2 0 8 0;
#X connect 2 1 8 1;
#X connect 4 0 2 0;
#X connect 4 1 2 1;
#X connect 4 2 2 2;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
#X restore 290 170 pd stamp;
#X obj 290 140 == 3;
#X obj 180 60 s \$0mode;
#X obj 50 110 r \$0mode;
#X obj 130 110 r \$0mode;
#X obj 210 110 r \$0mode;
#X obj 290 110 r \$0mode;
#X obj 70 20 loadbang;
#X msg 70 50 0;
#X obj 50 200 r \$0mode;
#X obj 50 230 == 4;
#N canvas 600 400 450 300 off 0;
#X obj 190 150 adc~;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#X obj 190 180 add~;
#X connect 0 0 3 0;
#X connect 0 1 3 1;
#X connect 1 0 2 0;
#X restore 50 260 pd off;
#X obj 190 200 hsl 187 22 0 1 0 0 empty empty empty -2 -11 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 200 230 hsl 187 22 0 1 0 0 empty empty empty -2 -11 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 190 260 s \$0opt1;
#X obj 270 260 s \$0opt2;
#N canvas 600 400 450 300 vol 0;
#X obj 130 80 all~;
#X obj 130 130 *~;
#X obj 170 130 *~;
#X obj 180 50 r \$0vol;
#X obj 180 80 zp~ 25 1;
#X obj 130 180 dac~;
#X obj 290 30 vsl 22 187 0.001 1 1 0 empty empty empty 0 -9 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 290 230 s \$0vol;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 1 0 5 0;
#X connect 2 0 5 1;
#X connect 3 0 4 0;
#X connect 4 0 2 1;
#X connect 4 0 1 1;
#X connect 6 0 7 0;
#X restore 290 80 pd vol;
#X connect 1 0 0 0;
#X connect 3 0 2 0;
#X connect 5 0 4 0;
#X connect 6 0 9 0;
#X connect 8 0 7 0;
#X connect 10 0 1 0;
#X connect 11 0 3 0;
#X connect 12 0 5 0;
#X connect 13 0 8 0;
#X connect 14 0 15 0;
#X connect 15 0 6 0;
#X connect 16 0 17 0;
#X connect 17 0 18 0;
#X connect 19 0 21 0;
#X connect 20 0 22 0;
