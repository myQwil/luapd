#N canvas 150 400 450 300 14;
#N canvas 600 400 450 300 echo 0;
#X obj 70 120 adc~;
#X obj 40 20 inlet;
#X obj 40 50 switch~;
#X obj 300 20 r \$0opt1;
#X obj 160 230 delwrite~ \$0-echoR 500;
#X obj 160 260 delwrite~ \$0-echoL 500;
#X obj 160 120 delread4~ \$0-echoL;
#X obj 160 150 delread4~ \$0-echoR;
#X obj 120 20 r \$0opt2;
#X obj 70 190 *~;
#X obj 130 190 *~;
#X obj 120 80 zp~ 25 0.5;
#X obj 300 80 zp~ 25 150;
#X obj 120 50 sly log 0.001 0.97 1;
#X obj 300 50 sly 50 500 1;
#X obj 70 260 add~;
#X connect 0 0 9 0;
#X connect 0 1 10 0;
#X connect 1 0 2 0;
#X connect 3 0 14 0;
#X connect 6 0 9 0;
#X connect 7 0 10 0;
#X connect 8 0 13 0;
#X connect 9 0 5 0;
#X connect 9 0 15 0;
#X connect 10 0 4 0;
#X connect 10 0 15 1;
#X connect 11 0 9 1;
#X connect 11 0 10 1;
#X connect 12 0 7 0;
#X connect 12 0 6 0;
#X connect 13 0 11 0;
#X connect 14 0 12 0;
#X restore 50 170 pd echo;
#X obj 50 140 == 0;
#N canvas 600 400 450 300 cos 0;
#X obj 170 100 adc~;
#X obj 40 40 inlet;
#X obj 40 70 switch~;
#X obj 170 140 cos~;
#X obj 220 140 cos~;
#X obj 170 180 add~;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 2 0;
#X connect 3 0 5 0;
#X connect 4 0 5 1;
#X restore 130 170 pd cos;
#X obj 130 140 == 1;
#N canvas 600 400 540 480 8ve 0;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#X obj 140 120 moses 1;
#X obj 160 150 mtof;
#X obj 270 210 samplerate~;
#X obj 160 210 t f b;
#X obj 150 60 delwrite~ G06-del 100;
#X obj 270 330 delread~ G06-del;
#X obj 160 330 vd~ G06-del;
#X obj 160 380 +~;
#X obj 160 240 +;
#X obj 160 180 expr 500/$f1;
#X obj 160 300 line~;
#X obj 160 270 pack 0 20;
#X text 210 150 fundamental frequency;
#X text 280 180 1/2 period \, in msec;
#X text 280 260 estimate fiddle~ delay;
#X obj 270 240 expr 2048000/$f1;
#X text 280 280 as one window (in msec);
#X obj 140 30 adc~;
#X obj 140 90 sigmund~ -npts 2048;
#X obj 160 410 add~;
#X connect 0 0 1 0;
#X connect 2 1 3 0;
#X connect 3 0 11 0;
#X connect 4 0 17 0;
#X connect 5 0 10 0;
#X connect 5 1 4 0;
#X connect 7 0 9 1;
#X connect 8 0 9 0;
#X connect 9 0 21 0;
#X connect 9 0 21 1;
#X connect 10 0 13 0;
#X connect 11 0 5 0;
#X connect 12 0 8 0;
#X connect 13 0 12 0;
#X connect 17 0 10 1;
#X connect 17 0 7 0;
#X connect 19 0 6 0;
#X connect 19 0 20 0;
#X connect 20 0 2 0;
#X restore 210 170 pd 8ve;
#X obj 210 140 == 2;
#X obj 180 30 hradio 22 1 0 5 empty empty empty 0 -11 0 14 #000000 #fcfcfc #fcfcfc 0;
#N canvas 600 400 450 300 stamp 0;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#N canvas 350 20 540 670 fft-analysis 0;
#X obj 90 530 *~;
#X obj 50 530 *~;
#X obj 330 330 *~;
#X obj 290 330 *~;
#X obj 290 360 +~;
#X obj 50 170 *~;
#X obj 50 140 inlet~;
#X obj 50 200 rfft~;
#X obj 50 590 *~;
#X obj 140 240 *~;
#X obj 290 300 rfft~;
#X obj 50 560 rifft~;
#X obj 50 620 outlet~;
#X obj 100 240 *~;
#X obj 100 270 +~;
#X text 370 360 modulus;
#X obj 100 460 *~;
#X obj 300 520 block~ 1024 4;
#X obj 100 420 clip~;
#X obj 90 170 tabreceive~ \$0-hann;
#X obj 300 550 loadbang;
#X obj 120 360 r squelch;
#X obj 120 390 expr 0.01*$f1*$f1;
#X obj 100 300 +~ 1e-20;
#X obj 100 500 *~ 0.00065;
#X obj 90 590 tabreceive~ \$0-hann;
#X obj 290 270 *~;
#X obj 290 240 inlet~;
#X obj 330 270 tabreceive~ \$0-hann;
#X obj 100 330 q8_rsqrt~;
#X obj 290 390 q8_sqrt~;
#X text 370 380 of control;
#X text 370 400 amplitude;
#X text 170 250 reciprocal;
#X text 170 270 modulus of;
#X text 170 290 filter input;
#X text 170 310 amplitude;
#X text 110 140 filter input;
#X text 360 240 control source;
#X text 360 300 Fourier transform;
#X text 40 10 Internal workings of the timbre stamping algorithm. First the "filter input" is treated as in the compressor patch \, multiplying each channel amplitude by one over its modulus (but limited by the "squelch" parameter.) It is then multiplied by the modulus of the channel amplitude for the control source (which is Fourier analyzed in parallel with the filter input.);
#X text 140 440 multiply the two amplitude;
#X text 140 460 factors (for compression;
#X text 140 480 and to apply new timbre);
#X msg 300 580 \; window-size 1024 \; squelch 500;
#X connect 0 0 11 1;
#X connect 1 0 11 0;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 30 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 13 0;
#X connect 7 0 13 1;
#X connect 7 0 1 0;
#X connect 7 1 9 0;
#X connect 7 1 9 1;
#X connect 7 1 0 0;
#X connect 8 0 12 0;
#X connect 9 0 14 1;
#X connect 10 0 3 0;
#X connect 10 0 3 1;
#X connect 10 1 2 0;
#X connect 10 1 2 1;
#X connect 11 0 8 0;
#X connect 13 0 14 0;
#X connect 14 0 23 0;
#X connect 16 0 24 0;
#X connect 18 0 16 0;
#X connect 19 0 5 1;
#X connect 20 0 44 0;
#X connect 21 0 22 0;
#X connect 22 0 18 2;
#X connect 23 0 29 0;
#X connect 24 0 0 1;
#X connect 24 0 1 1;
#X connect 25 0 8 1;
#X connect 26 0 10 0;
#X connect 27 0 26 0;
#X connect 28 0 26 1;
#X connect 29 0 18 0;
#X connect 30 0 16 1;
#X restore 230 150 pd fft-analysis;
#N canvas 950 160 560 520 hann-window 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-hann 1024 float 0;
#X coords 0 1 1023 0 300 100 1;
#X restore 120 390 graph;
#X obj 360 210 osc~;
#X obj 360 240 *~ -0.5;
#X obj 360 270 +~ 0.5;
#X obj 340 330 tabwrite~ \$0-hann;
#X obj 60 110 r window-size;
#X obj 170 240 /;
#X obj 190 200 samplerate~;
#X obj 170 330 s window-sec;
#X obj 60 240 swap;
#X obj 60 270 /;
#X obj 60 330 s window-hz;
#X obj 180 270 * 1000;
#X obj 180 300 s window-msec;
#X obj 60 140 t f b f;
#X msg 190 140 resize \$1;
#X obj 190 170 s \$0-hann;
#X obj 310 140 r window-hz;
#X msg 390 170 0;
#X obj 310 170 t f b;
#X text 50 20 calculate Hann window table (variable window size) and constants window-hz (fundamental frequency of analysis) \, window-sec and window-msec (analysis window size in seconds and msec)., f 56;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 14 0;
#X connect 6 0 8 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 7 0 9 1;
#X connect 9 0 10 0;
#X connect 9 1 10 1;
#X connect 10 0 11 0;
#X connect 12 0 13 0;
#X connect 14 0 6 0;
#X connect 14 0 9 0;
#X connect 14 1 7 0;
#X connect 14 2 15 0;
#X connect 15 0 16 0;
#X connect 17 0 19 0;
#X connect 18 0 1 1;
#X connect 19 0 1 0;
#X connect 19 1 4 0;
#X connect 19 1 18 0;
#X restore 230 90 pd hann-window;
#N canvas 380 50 450 300 signals 0;
#X obj 90 230 outlet~;
#X obj 290 230 outlet~;
#X obj 290 140 adc~;
#X obj 90 200 fm2op~ 1 0 25 4;
#X obj 90 60 metro 10000;
#X obj 90 30 tgl 19 0 empty empty empty 0 -10 0 12 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 90 150 line~;
#X msg 90 120 \$1 10000;
#X obj 90 90 rind 2 8;
#X obj 120 30 loadbang;
#X obj 290 170 +~;
#X obj 290 200 *~ 0.5;
#X obj 200 30 r \$0opt1;
#X obj 170 120 zp~ 25 25;
#X obj 200 60 sly log 12.5 500 1;
#X connect 2 0 10 0;
#X connect 2 1 10 1;
#X connect 3 0 0 0;
#X connect 4 0 8 0;
#X connect 5 0 4 0;
#X connect 6 0 3 3;
#X connect 7 0 6 0;
#X connect 8 0 7 0;
#X connect 9 0 4 0;
#X connect 10 0 11 0;
#X connect 11 0 1 0;
#X connect 12 0 14 0;
#X connect 13 0 3 2;
#X connect 14 0 13 0;
#X restore 230 120 pd signals;
#X obj 60 190 s squelch;
#X obj 60 120 r \$0opt2;
#X obj 60 150 sly 0 2000 1;
#X obj 230 190 add~;
#X connect 0 0 1 0;
#X connect 2 0 8 0;
#X connect 2 0 8 1;
#X connect 4 0 2 0;
#X connect 4 1 2 1;
#X connect 6 0 7 0;
#X connect 7 0 5 0;
#X restore 290 170 pd stamp;
#X obj 290 140 == 3;
#X obj 180 60 s \$0mode;
#X obj 50 110 r \$0mode;
#X obj 130 110 r \$0mode;
#X obj 210 110 r \$0mode;
#X obj 290 110 r \$0mode;
#X obj 70 20 loadbang;
#X msg 70 50 0;
#X obj 50 200 r \$0mode;
#X obj 50 230 == 4;
#N canvas 600 400 450 300 off 0;
#X obj 190 150 adc~;
#X obj 40 30 inlet;
#X obj 40 60 switch~;
#X obj 190 180 add~;
#X connect 0 0 3 0;
#X connect 0 1 3 1;
#X connect 1 0 2 0;
#X restore 50 260 pd off;
#X obj 190 200 hsl 187 22 0 1 0 0 empty empty empty -2 -11 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 200 230 hsl 187 22 0 1 0 0 empty empty empty -2 -11 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 190 260 s \$0opt1;
#X obj 270 260 s \$0opt2;
#N canvas 600 400 450 300 vol 0;
#X obj 130 80 all~;
#X obj 130 130 *~;
#X obj 170 130 *~;
#X obj 180 50 r \$0vol;
#X obj 180 80 zp~ 25 1;
#X obj 130 180 dac~;
#X obj 290 30 vsl 22 187 0.001 1 1 0 empty empty empty 0 -9 0 14 #000000 #fcfcfc #fcfcfc 0 1;
#X obj 290 230 s \$0vol;
#X connect 0 0 1 0;
#X connect 0 1 2 0;
#X connect 1 0 5 0;
#X connect 2 0 5 1;
#X connect 3 0 4 0;
#X connect 4 0 2 1;
#X connect 4 0 1 1;
#X connect 6 0 7 0;
#X restore 290 80 pd vol;
#X connect 1 0 0 0;
#X connect 3 0 2 0;
#X connect 5 0 4 0;
#X connect 6 0 9 0;
#X connect 8 0 7 0;
#X connect 10 0 1 0;
#X connect 11 0 3 0;
#X connect 12 0 5 0;
#X connect 13 0 8 0;
#X connect 14 0 15 0;
#X connect 15 0 6 0;
#X connect 16 0 17 0;
#X connect 17 0 18 0;
#X connect 19 0 21 0;
#X connect 20 0 22 0;
